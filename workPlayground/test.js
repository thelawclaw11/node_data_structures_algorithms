const axios = require("axios");

const prodCookie = `CognitoIdentityServiceProvider.e2ipqnqqdrr9j00chhrloeqno.claw.refreshToken=eyJjdHkiOiJKV1QiLCJlbmMiOiJBMjU2R0NNIiwiYWxnIjoiUlNBLU9BRVAifQ.Lim1W858wVNdd06WSmSoX6Pycs2uWne24MGW4P1FieunzGbhfK5j3iHaA65Hraiq0PQlHXiK9-V90iQGtsA6aQcFTjjkDvwNogAO48HQly5vKb-dZx4oLtZfdrbAF6IsXT7_ZW_kLYudPoS4TX9FJVgpbdXaH48IzaK14cwm_CmnyvoPBoRNHgan75OTRBNxuolKhPHrrQPAU9_olnW9Ooi0uMm4YOZMvdwN84s1e8___iXNJM8vrV3dURZYmzyUrfY2BOXjulpXS0wGrmcahuip2ZhWZtbOSOO0xnRJceZrwYGiQQAGu7fEhplNIpR1qLBdWClKm9p6BtB7zpmW7A.sIz-yO4tgQLxLGSY.3StEv7qrQTNKhKdqjTnG_MGZwyuhsgIE8I1Mu0A0ghPfEkg-NrXv9en8iPfxhAg_wr8zwcHyphjZBb2PwRoTBKMq7Y68rfsHNaVoZo9Zw9Km4VaLTFf4nA2OeHAlxeQBoDj0SY0jGbNK9HsLYs8_pUX8ZQaqH-8eVEbLLkFM6AE22E6rpa9qAC9G_QeiRuEpxs7J33B5ZHS5aQdPXheSazGD8FKsExOYbpX1OZMR4ZUF71ajNJfZj5YXlai6ODn4KAtGDh6wq4-xpnT75OmlVW4OmnYcKQMnypdi_XNTf7Wzac9fHCLdXVtYLM4kz93G28lqfiRIqnWyFbFI7fQfJPU4ER1MpZYmrahDZTcigrByy5tnKaxMmt8eijxW7Jg1wziro3QkCT4JidWI8T2NPB73kEteTEtfhJ6nEcFQEBEkdPR8Jdxo17cakC0kOgz7jQT-TBph5sXo5cqBHazFo_KrF2tvFQ2C_nTnUomvx_ZobMTAQdxwynSZLGqWy-RmmQKf3xqgZk5q-PqwhGI2QPeXI3Ju0ary9gJVUWOQHlrsC2L3NbaX3NQ_nHWNVdF2l2m0B8UKk8AQwn4zF2ZE3XNVLPt2ibELWKphyLF9tdGFiOF1QrPUJPqx55vEHoWUOtmxN0ODqXxbTe26j-RK8k_5P13qnKpKzOHpsjeQxnRx7HmyJ-QzxUxckmNG3XqbwlGqrw_puPt_BSqipB2M_mzoDEXZ08xAZbhuANMHRhc1xDXSpdOeOSpcPCTjptFA6mCB9TW5t-JAYKnFktxna-eDZcNu6WNsaMn9Wm6r7g4M2KKSDCjjo0e2RU1b9S6-zBcvcxKeURcYRLom-93K_qAQxTzk1z3oEnnucnp7oWFrSyRoloOKFEEgzR1YjVsQPMBYf-zvmvt-3RyTgUZJHv99cuXF44y-VFR3H8jwOhm7Zpt3DBHD0Lt-uN-NS17fgcTB-YisLyj5YJ9VA58RzV-5ze7R4HoXVxD987tIgFgBuqd4H-7XUqr_sLjU0-73yEUmqCdHyekhF2boa4dMR8HgVUb6KEOkymNvvEtosemfVehKmm2u2t7TjweOMttfGWFW9ByryGSdAhI4mZPGY_8YFkcbWf1eKDlEnURr5YDl38YgsFPZsKybP96DhNETL3FLhrBFfCDQwO3EpRaAF4Ei5yykDk9McP7PE0o4uaSJ1nEbAVH3Pkg2wsizXGBFaZIgyiWS2SCAtcqzxiuVUo0DocvkeUHWtiMW9RUZXANgs5NOsrg3SxZksoMlhkE.O9oGBC6JaroyNZBs367fAA; CognitoIdentityServiceProvider.e2ipqnqqdrr9j00chhrloeqno.LastAuthUser=claw; CognitoIdentityServiceProvider.e2ipqnqqdrr9j00chhrloeqno.claw.userData={"UserAttributes":[{"Name":"sub","Value":"434f40ce-1ccc-45fc-9c59-eac27ebbc816"},{"Name":"email_verified","Value":"true"},{"Name":"given_name","Value":"Canon"},{"Name":"family_name","Value":"Law"},{"Name":"email","Value":"claw@ancestry.com"}],"Username":"claw"}; amplify-signin-with-hostedUI=false; CognitoIdentityServiceProvider.e2ipqnqqdrr9j00chhrloeqno.claw.idToken=eyJraWQiOiJnT2hMcndPNTJ5WldJSUg5cmwzT09oNE9ickE3SjlKVUE4d000aitwTFJFPSIsImFsZyI6IlJTMjU2In0.eyJzdWIiOiI0MzRmNDBjZS0xY2NjLTQ1ZmMtOWM1OS1lYWMyN2ViYmM4MTYiLCJjb2duaXRvOmdyb3VwcyI6WyJST0xFX1BST0pFQ1RNQU5BR0VSIiwiVEVBTV8xIl0sImVtYWlsX3ZlcmlmaWVkIjp0cnVlLCJpc3MiOiJodHRwczpcL1wvY29nbml0by1pZHAudXMtZWFzdC0xLmFtYXpvbmF3cy5jb21cL3VzLWVhc3QtMV9PVDNMc1NsaTciLCJjb2duaXRvOnVzZXJuYW1lIjoiY2xhdyIsImdpdmVuX25hbWUiOiJDYW5vbiIsImF1ZCI6ImUyaXBxbnFxZHJyOWowMGNoaHJsb2Vxbm8iLCJldmVudF9pZCI6IjBmZDgzYTIyLWI3NjYtNDczNi05YjcyLWY1OGExZmM4ZTE5MCIsInRva2VuX3VzZSI6ImlkIiwiYXV0aF90aW1lIjoxNjU1MTY2OTkzLCJleHAiOjE2NTUxNzQ3MjcsImlhdCI6MTY1NTE3MTEyNywiZmFtaWx5X25hbWUiOiJMYXciLCJlbWFpbCI6ImNsYXdAYW5jZXN0cnkuY29tIn0.G_DUF3A7_0_BZeznTzUPYAMuAQeFluVIT6aQFCT6_tFdvFMhMfCmCC0UEyICu5Cx6g3VZv3MXe4VzCTq3gY8xuPTQZ01PxRjJAbQHB9zSxcDGA0YzHoD8aCYMJlV4zZlXV-8sybK2NR2WGiHkptrNOgLBfN8CdganZkE2YVRd802zXeE16D6Zlc-ZhzFhVQeuEiaWp4x-dUd9MyEoTgwjyEHNn8P7yWuoziNrafgjpohQnmekf2_1VCbOfV0VwC_xP5cOp9zw7W18dvMwegGZ9mVWX-cBY6OvT7CQgIOgcRzRS3KDtomKzjMF-eMk1i85QsQrQdrh3dg2_NikoL-5g; CognitoIdentityServiceProvider.e2ipqnqqdrr9j00chhrloeqno.claw.accessToken=eyJraWQiOiJTRnlXbEE2aDB4eEhjUDFFSHUwbUJcL3hsVDBFV3hNanlvckY1eXNiMzlnbz0iLCJhbGciOiJSUzI1NiJ9.eyJzdWIiOiI0MzRmNDBjZS0xY2NjLTQ1ZmMtOWM1OS1lYWMyN2ViYmM4MTYiLCJjb2duaXRvOmdyb3VwcyI6WyJST0xFX1BST0pFQ1RNQU5BR0VSIiwiVEVBTV8xIl0sImlzcyI6Imh0dHBzOlwvXC9jb2duaXRvLWlkcC51cy1lYXN0LTEuYW1hem9uYXdzLmNvbVwvdXMtZWFzdC0xX09UM0xzU2xpNyIsImNsaWVudF9pZCI6ImUyaXBxbnFxZHJyOWowMGNoaHJsb2Vxbm8iLCJldmVudF9pZCI6IjBmZDgzYTIyLWI3NjYtNDczNi05YjcyLWY1OGExZmM4ZTE5MCIsInRva2VuX3VzZSI6ImFjY2VzcyIsInNjb3BlIjoiYXdzLmNvZ25pdG8uc2lnbmluLnVzZXIuYWRtaW4iLCJhdXRoX3RpbWUiOjE2NTUxNjY5OTMsImV4cCI6MTY1NTE3NDcyNywiaWF0IjoxNjU1MTcxMTI3LCJqdGkiOiIwZTExODEzYi02NTA3LTQzYzItYTZhZS02NDk3MjQ1YzljM2IiLCJ1c2VybmFtZSI6ImNsYXcifQ.I8EGdaR1K_i_wL4Ap6u3ioNMdEHen_kEqUCbnQVxRV-UaxrciXgn8CtZQfZ130vooD2oK4CkZ83_mtpfsMolP41_wmKB37bZLh-RlPNLuG02-14ksjkejlYrglcgkMxqFr6Kh4PYKherzW8na0kClQdGgATnEifOYgxIsjD7oMUKFN8j6QYHuayBW7oOtBS7qOwKw020w_ClG1EaRS4Q1B-FgZS5Pl1LJ3na08Tsp2s3B09aSrhibihhL92MyL6TSG_iU9zq81hrXR0a4WL1rNVgBdib1Z8bObiNa6lfuu1y2yOpHD_EVHWpnh8VfqLQPfeMB3CZB6UFmR28DJFFLw; CognitoIdentityServiceProvider.e2ipqnqqdrr9j00chhrloeqno.claw.clockDrift=0`;
const stageCookie = `CognitoIdentityServiceProvider.4mj15q44qa60a16o90mkeete2f.claw.idToken=eyJraWQiOiJCYlNjQnNVelZsRUE4YzZKMkdRQnNRY0RXbXJWOHhySGRkZjluVHhjcGN3PSIsImFsZyI6IlJTMjU2In0.eyJzdWIiOiIzZTVlNzE4Mi1iMWQzLTQzZGUtYWU2YS02NGQ5ODU3MDlmNmQiLCJjb2duaXRvOmdyb3VwcyI6WyJURUFNXzIiLCJST0xFX1BST0pFQ1RNQU5BR0VSIl0sImVtYWlsX3ZlcmlmaWVkIjp0cnVlLCJpc3MiOiJodHRwczpcL1wvY29nbml0by1pZHAudXMtZWFzdC0xLmFtYXpvbmF3cy5jb21cL3VzLWVhc3QtMV83STlVUThHZm0iLCJjb2duaXRvOnVzZXJuYW1lIjoiY2xhdyIsImdpdmVuX25hbWUiOiJDYW5vbiIsImF1ZCI6IjRtajE1cTQ0cWE2MGExNm85MG1rZWV0ZTJmIiwiZXZlbnRfaWQiOiIzNmNhNWE0Yy0wYmI0LTQ3NGQtYWEzOS1iZjllMzZkYTQxM2MiLCJ0b2tlbl91c2UiOiJpZCIsImF1dGhfdGltZSI6MTY1NTEzODQwNSwiZXhwIjoxNjU1MTQyMDA1LCJpYXQiOjE2NTUxMzg0MDUsImZhbWlseV9uYW1lIjoiTGF3IiwiZW1haWwiOiJjbGF3QGFuY2VzdHJ5LmNvbSJ9.lMPnOKAkZYF_NqmOxhiZbSx620kUB2U8MwwYK0-rKbJ2DZv1YyEioDSw6AzAM0EdH0kv2-KmX90XcxKxYMODjrjP1nAtHpzkxbH0XT85YMdH6moaOutnVRfBaUdLJjQ79CDDkBMYbctI_jEROpMZkH8w0u4dzNVV7MTXOBMMMytnhg2Ddacd4oiYd3PryhEnBwcLQY8bbvguCokk7WYT308muYmpbDuMel_4fs2E4KSMhe7S3GLCtLgiWsjgcFvFPCRq1z2-oZxzIkB4BWcTTwWYpE5qsEGKvOs5YbvZ9rjPG8hELF2HWnyerPBNelh-IOgTiw9GbSd02_mohm8JfA; CognitoIdentityServiceProvider.4mj15q44qa60a16o90mkeete2f.claw.accessToken=eyJraWQiOiIyRVwvelFjVkp6c1E3dDFHcmxBanJrTU0yemhyd0s2R0ROVkJLUDROUm5taz0iLCJhbGciOiJSUzI1NiJ9.eyJzdWIiOiIzZTVlNzE4Mi1iMWQzLTQzZGUtYWU2YS02NGQ5ODU3MDlmNmQiLCJjb2duaXRvOmdyb3VwcyI6WyJURUFNXzIiLCJST0xFX1BST0pFQ1RNQU5BR0VSIl0sImlzcyI6Imh0dHBzOlwvXC9jb2duaXRvLWlkcC51cy1lYXN0LTEuYW1hem9uYXdzLmNvbVwvdXMtZWFzdC0xXzdJOVVROEdmbSIsImNsaWVudF9pZCI6IjRtajE1cTQ0cWE2MGExNm85MG1rZWV0ZTJmIiwiZXZlbnRfaWQiOiIzNmNhNWE0Yy0wYmI0LTQ3NGQtYWEzOS1iZjllMzZkYTQxM2MiLCJ0b2tlbl91c2UiOiJhY2Nlc3MiLCJzY29wZSI6ImF3cy5jb2duaXRvLnNpZ25pbi51c2VyLmFkbWluIiwiYXV0aF90aW1lIjoxNjU1MTM4NDA1LCJleHAiOjE2NTUxNDIwMDUsImlhdCI6MTY1NTEzODQwNSwianRpIjoiMTNiZDc0MmYtNWI1YS00NWVjLTllY2YtM2FmM2VkMThjZjg0IiwidXNlcm5hbWUiOiJjbGF3In0.H8TachwuvnPRTqi0jFPGa56Xk7jWxB4xGbrljsGTBYhM_ql5YR_8_jIhKAkYvrVpNKbTllv-eShjt1qPI2GzzWJhcQm1OAXrTzxPpPSGL-OpN5oVObS59w6At3ffB143FTSgrUELXouTgDH1oLcyRi_xro_ldTELCVzt1UNJusufTWNczMsCqJO8YK52VlLp8UwfnUTcgX-dn4ujHtraOYWxFsr9VyJ_TzWa0EHIuirqH3QrMbkwa6a_suD-cGBW6-w-2Edzk8lYhdU0hfZQ8teRtgq8we9YYP0r1tKihGQAXLXqv1epuhKJ3B3lKTVuoNN6cK2QzYixs3qMZvozJA; CognitoIdentityServiceProvider.4mj15q44qa60a16o90mkeete2f.claw.refreshToken=eyJjdHkiOiJKV1QiLCJlbmMiOiJBMjU2R0NNIiwiYWxnIjoiUlNBLU9BRVAifQ.Ze_AI5UnRFKuJ9SW9d8hc7ilhNyJvBH0uROkgsrgG2hx7JdatzuQiaJncBMxJCJVIV2d6OkCfaGM3DWTFHhew6KrdTvC5qXf6aL12B2QGb6yTdwhFISKAEkoLhTyktrcPn-Uvrza-Q8HEvbji2qX-r_x9iAwN0lsGPmJYXpfFLAkfFM4sz47smCGkTwA5HYQlw1JyoyAVi1ypH1ONtNnq9u1NYgHAUWVGOQdm6p91endAuxHE-SIqNy1aP7RAFlVL7-D_fwpKvDeCXwyQCp3KrC3qfoSw3KrAU1pkies_hFUfmAB_xbDDgZKwZ1A2dw_Vw_QtCWB5R5LdPA5CvNIaA.-cykZXUIDI5oMPbX.5yFrDXFn4QvxqWVgkLhdcQ6Z9680WRxQ--PxA6wV9wlNs7a9HQdhUfoiribkK0cQwvf4OdZstlpvWMD-p--AzPqNLXPoeCPQ1j3X8oxYYAt103hP7w67XQLfjUEKxZqUBRHrQT7VpK1VWkdThC6rYMvOWebc2phBRP066nDCQ9QXBJz8a_1ug33b-c55ZlaRX9syPOsnWUmpHoYTBoWZGjN4ajABpezXq9mhe_dNjmop7Xr25rw0QNwOnMINjZqUzXlr38_6bMsDDCOAyAY_CGY8NronA0uYz3ljtE9hIJZ6f-AaOvR0ptlHZk4wgBxNBZ6qobdhTvz6x-TybEgQX0PzpTz3g_GJrgC0RqHaY9FLF9kApBL783U5YKp2_1dnZQsF3bx3G-BmeK1yQXNW7Vb5kxdiGbVYBrcNlvxa4xET4R37DtKv9WgEW-CgmZhfSaifAGC75tpzzXMnYoRYrWjLKH3GFDsMu7Cjt1CY2SNijmIkzcqylgLq1zx8oAs6lNlgFIfXnq16gFPODGfI6io1yvS4V9G6kRv7fea13t57y6y5LnDYRppgNNCc90TpvKTki8AlPQiXS-61NV25f0wIkwdHmoQt0kA7kVVJ4YOo0twUAjtVbmXYr4F-RrSOBl9JallY-mPfSC-gJXkzaqNd-21ouRLagGkXM7wSQvWp2D7JOnHviz9Qc2kQZAS9m73_Gw3dBOU3VbTX_2tg5ZIa0w_p76Mz396zFKZ_sYeJguP1l2T_zr3L2qAJY3BMFfpoYyiQ3CJr5COW9PMV7i6lMhO_67im9iQCnOXKjxo5lD81wiBArMmKfHmraZE9g0qQepa7APwJevj0fRzbWX5J9L4Csz7JHXXtIdJ_KRD0pXqPZQwTtM4uP6idVQPiVIFhGDrw6ua8QXTDWuFF1A6JitWieZyAXWqwWasij33thJmlffYh7LEv1PDZi1PTqGGOpl6E5p9zLQ-8t_pNtndjB2FsHmnKqH-SkbScSj0bVvFQb4UulMiywbXvByrsXYDdYwlOziXLIrHZde2kN6HP0kMU2Xlwy_TiKapTicobi8oTEt2A7dD0C40ULrqm3JhyabyqJRNsZ41ZFl6TvahLp1FZraZZ_FdqNWFOznmPMc8nMbmaehE3QJ0sruJfMzmY0RH0nhHYgmMGVs5g5j7Bft-dYeQn1ffr5mClDIdE_31CcfCwqWcHFRoPwcqfbCxza4Nz-26OwrtXhriALxUj8O2LE-87wywe5_Lsq_cteWzcaNPAilqXkxLPDOKcgw.RrnbdDc0Aqxxn6gNqMT04w; CognitoIdentityServiceProvider.4mj15q44qa60a16o90mkeete2f.claw.clockDrift=0; CognitoIdentityServiceProvider.4mj15q44qa60a16o90mkeete2f.LastAuthUser=claw; CognitoIdentityServiceProvider.4mj15q44qa60a16o90mkeete2f.claw.userData={"UserAttributes":[{"Name":"sub","Value":"3e5e7182-b1d3-43de-ae6a-64d985709f6d"},{"Name":"email_verified","Value":"true"},{"Name":"given_name","Value":"Canon"},{"Name":"family_name","Value":"Law"},{"Name":"email","Value":"claw@ancestry.com"}],"Username":"claw"}; amplify-signin-with-hostedUI=false`;

const prodBase = "https://app.pulseline.cloud";
const stageBase = "https://app.pulselinestage.cloud";

const prodConfig = {
    base: prodBase,
    cookie: prodCookie,
};

const stageConfig = {
    base: stageBase,
    cookie: stageCookie,
};

const config = prodConfig;

const SIZE = 50;

const main = async () => {
    const containers = [];

    const firstPage = await axios.get(
        `${config.base}/flow-api/containers-active?size=${SIZE}&sort=id`,
        {
            headers: { cookie: config.cookie },
        }
    );
    if (firstPage.data._embedded.containers) {
        containers.push(...firstPage?.data?._embedded.containers);
    }

    // console.log(firstPage);

    const totalPages = firstPage.data.page.totalPages;

    for (let i = 1; i < totalPages; i++) {
        const nextPage = await axios.get(
            `${config.base}/flow-api/containers-active?size=${SIZE}&page=${i}&sort=id`,
            { headers: { cookie: config.cookie } }
        );

        if (nextPage?.data?._embedded?.containers) {
            containers.push(...nextPage?.data?._embedded?.containers);
        }
    }

    const containerIds = containers.map((container) => container.id);

    const table = {};
    const set = new Set(containerIds);

    // console.log(table);
    console.log("Expected items: ", firstPage.data.page.totalElements);
    console.log("total items received: ", containerIds.length);
    console.log("unique ids: ", set.size);
};

main();
